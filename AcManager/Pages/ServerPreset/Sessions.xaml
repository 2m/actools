<UserControl x:Class="AcManager.Pages.ServerPreset.Sessions" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:local="clr-namespace:AcManager.Pages.ServerPreset"
    xmlns:mui="http://firstfloorsoftware.com/ModernUI" xmlns:sys="clr-namespace:System;assembly=mscorlib" xmlns:t="http://acstuff.ru/app/tools"
    xmlns:c="http://acstuff.ru/app/controls" xmlns:g="clr-namespace:AcManager" mc:Ignorable="d" d:DataContext="{d:DesignInstance local:SelectedPage+ViewModel}">
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <mui:SharedResourceDictionary Source="/AcManager.Controls;component/Assets/Converters.xaml" />
        <mui:SharedResourceDictionary Source="/AcManager.Controls;component/Assets/SettingsSpecific.xaml" />
      </ResourceDictionary.MergedDictionaries>

      <DataTemplate x:Key="SessionTemplate">
        <ContentControl Content="{Binding}" Background="Transparent">
          <ContentControl.Resources>
            <DataTemplate DataType="{x:Type t:ServerSessionEntry}">
              <DockPanel IsEnabled="{Binding IsAvailable}">
                <CheckBox IsChecked="{Binding IsEnabled}" DockPanel.Dock="Top" Margin="0 0 0 8">
                  <Label>
                    <TextBlock Text="{Binding DisplayName}" Style="{StaticResource Heading2}" />
                  </Label>
                </CheckBox>

                <StackPanel Style="{StaticResource SettingsPanel}" Margin="0" IsEnabled="{Binding IsEnabled}">
                  <!--<DockPanel>
                      <Label Content="Name:" />
                      <mui:BetterTextBox Text="{Binding ConfigName}" Placeholder="{Binding DisplayName}" />
                    </DockPanel>-->

                  <DockPanel ToolTip="{Binding Time, Converter={StaticResource ReadableTimeSpanConverter}}">
                    <mui:ValueLabel Value="{Binding Time, Converter={StaticResource TimeSpanHhMmSsConverter}}" Content="Time" mui:BetterTextBox.Mode="Time" />
                    <Slider Minimum="1" Maximum="90" TickFrequency="8.9" TickPlacement="BottomRight"
                        Value="{Binding Time, Converter={StaticResource TimeSpanMinutesConverter}, ConverterParameter=1}" />
                  </DockPanel>

                  <CheckBox IsChecked="{Binding IsOpen}" Visibility="{Binding IsClosable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Label Content="Can join" />
                  </CheckBox>
                </StackPanel>
              </DockPanel>
            </DataTemplate>

            <DataTemplate DataType="{x:Type t:ServerQualificationSessionEntry}">
              <DockPanel IsEnabled="{Binding IsAvailable}">
                <CheckBox IsChecked="{Binding IsEnabled}" DockPanel.Dock="Top" Margin="0 0 0 8">
                  <Label>
                    <TextBlock Text="{Binding DisplayName}" Style="{StaticResource Heading2}" />
                  </Label>
                </CheckBox>

                <StackPanel Style="{StaticResource SettingsPanel}" Margin="0" IsEnabled="{Binding IsEnabled}">
                  <!--<DockPanel>
                      <Label Content="Name:" />
                      <mui:BetterTextBox Text="{Binding ConfigName}" Placeholder="{Binding DisplayName}" />
                    </DockPanel>-->

                  <DockPanel ToolTip="{Binding Time, Converter={StaticResource ReadableTimeSpanConverter}}">
                    <mui:ValueLabel Value="{Binding Time, Converter={StaticResource TimeSpanHhMmSsConverter}}" Content="Time" mui:BetterTextBox.Mode="Time" />
                    <Slider Minimum="1" Maximum="90" TickFrequency="8.9" TickPlacement="BottomRight"
                        Value="{Binding Time, Converter={StaticResource TimeSpanMinutesConverter}, ConverterParameter=1}" />
                  </DockPanel>

                  <CheckBox IsChecked="{Binding IsOpen}" Visibility="{Binding IsClosable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Label Content="Can join" />
                  </CheckBox>

                  <DockPanel>
                    <mui:ValueLabel Value="{Binding QualifyLimitPercentage}" Postfix="%" Content="Qualify limit" />
                    <Slider Minimum="100" Maximum="200" Value="{Binding QualifyLimitPercentage}" TickFrequency="25" TickPlacement="BottomRight" />
                  </DockPanel>
                </StackPanel>
              </DockPanel>
            </DataTemplate>

            <DataTemplate DataType="{x:Type t:ServerRaceSessionEntry}">
              <DockPanel IsEnabled="{Binding IsAvailable}">
                <CheckBox IsChecked="{Binding IsEnabled}" DockPanel.Dock="Top" Margin="0 0 0 8">
                  <Label>
                    <TextBlock Text="{Binding DisplayName}" Style="{StaticResource Heading2}" />
                  </Label>
                </CheckBox>

                <StackPanel Style="{StaticResource SettingsPanel}" Margin="0" IsEnabled="{Binding IsEnabled}">
                  <!--<DockPanel>
                      <Label Content="Name:" />
                      <mui:BetterTextBox Text="{Binding ConfigName}" Placeholder="{Binding DisplayName}" />
                    </DockPanel>-->

                  <DockPanel>
                    <Label Content="Limit by:" />
                    <mui:LabeledToggleButton IsChecked="{Binding LimitByTime}" LabelChecked="Time" LabelUnchecked="Laps" Margin="0 0 0 0" />
                  </DockPanel>

                  <mui:BooleanSwitch Value="{Binding LimitByTime}">
                    <mui:BooleanSwitch.True>
                      <DockPanel ToolTip="{Binding Time, Converter={StaticResource ReadableTimeSpanConverter}}">
                        <mui:ValueLabel Value="{Binding Time, Converter={StaticResource TimeSpanHhMmSsConverter}}" Content="Time" mui:BetterTextBox.Mode="Time"
                            VerticalAlignment="Top" Margin="0 6 16 0" />
                        <CheckBox IsChecked="{Binding ExtraLap}" Margin="0 4 0 0" DockPanel.Dock="Bottom">
                          <Label Content="Extra lap" />
                        </CheckBox>
                        <Slider Minimum="1" Maximum="90" TickFrequency="8.9" TickPlacement="BottomRight"
                            Value="{Binding Time, Converter={StaticResource TimeSpanMinutesConverter}, ConverterParameter=1}" />
                      </DockPanel>
                    </mui:BooleanSwitch.True>
                    <mui:BooleanSwitch.False>
                      <DockPanel>
                        <mui:ValueLabel Value="{Binding LapsCount}" Content="{x:Static g:AppStrings.Drive_RaceDuration}"
                            Postfix="{Binding LapsCount, Converter={StaticResource PluralizingConverter}, ConverterParameter={x:Static c:ControlsStrings.Common_LapsPostfix}}" />
                        <Slider Minimum="0" Maximum="1" TickPlacement="BottomRight" TickFrequency="0.1">
                          <Slider.Value>
                            <Binding Path="LapsCount">
                              <Binding.Converter>
                                <mui:LogarithmicScale Minimum="1" Middle="40" Maximum="120" />
                              </Binding.Converter>
                            </Binding>
                          </Slider.Value>
                        </Slider>
                      </DockPanel>
                    </mui:BooleanSwitch.False>
                  </mui:BooleanSwitch>

                  <DockPanel ToolTip="{Binding WaitTime, Converter={StaticResource ReadableTimeSpanConverter}}">
                    <mui:ValueLabel Value="{Binding WaitTime, Converter={StaticResource TimeSpanHhMmSsConverter}}" Content="Initial delay"
                        mui:BetterTextBox.Mode="Time" />
                    <Slider Minimum="1" Maximum="120" TickFrequency="11.9" TickPlacement="BottomRight"
                        Value="{Binding WaitTime, Converter={StaticResource TimeSpanSecondsConverter}, ConverterParameter=1}" />
                  </DockPanel>

                  <DockPanel>
                    <DockPanel.ToolTip>
                      <ToolTip Content="{Binding RaceOverTime, Converter={StaticResource ReadableTimeSpanConverter}}"
                          ContentStringFormat="{}Time the server is going to wait for players to end the race: {0}" />
                    </DockPanel.ToolTip>
                    <mui:ValueLabel Value="{Binding RaceOverTime, Converter={StaticResource TimeSpanHhMmSsConverter}}" Content="Race over" />
                    <Slider Minimum="0" Maximum="300" TickFrequency="30" TickPlacement="BottomRight"
                        Value="{Binding RaceOverTime, Converter={StaticResource TimeSpanSecondsConverter}, ConverterParameter=1}" />
                  </DockPanel>

                  <DockPanel>
                    <DockPanel.ToolTip>
                      <ToolTip Content="{Binding ResultScreenTime, Converter={StaticResource ReadableTimeSpanConverter}}"
                          ContentStringFormat="{}Time the server is going to wait for players to end the race: {0}" />
                    </DockPanel.ToolTip>
                    <mui:ValueLabel Value="{Binding ResultScreenTime, Converter={StaticResource TimeSpanHhMmSsConverter}}" Content="Result screen" />
                    <Slider Minimum="0" Maximum="120" TickFrequency="15" TickPlacement="BottomRight"
                        Value="{Binding ResultScreenTime, Converter={StaticResource TimeSpanSecondsConverter}, ConverterParameter=1}" />
                  </DockPanel>

                  <DockPanel>
                    <Label Content="Join type:" />
                    <ComboBox ItemsSource="{x:Static local:SelectedPage.RaceJoinTypes}" SelectedItem="{Binding JoinType}">
                      <ComboBox.ItemTemplate>
                        <DataTemplate>
                          <TextBlock Text="{Binding Converter={StaticResource EnumToDescriptionConverter}}" />
                        </DataTemplate>
                      </ComboBox.ItemTemplate>
                    </ComboBox>
                  </DockPanel>

                  <DockPanel>
                    <CheckBox IsChecked="{Binding MandatoryPit}" DockPanel.Dock="Left" Width="148" Margin="0 4 8 0">
                      <Label Content="Mandatory pit" />
                    </CheckBox>

                    <mui:BooleanSwitch Value="{Binding LimitByTime}" Margin="0 4 0 0" IsEnabled="{Binding MandatoryPit}">
                      <mui:BooleanSwitch.True>
                        <mui:SpacingUniformGrid HorizontalSpacing="8" Rows="1">
                          <mui:ValueLabel Value="{Binding MandatoryPitFrom}" Content="From" Postfix=" min" mui:BetterTextBox.Mode="Integer" Margin="0" />
                          <mui:ValueLabel Value="{Binding MandatoryPitTo}" Content="To" Postfix=" min" mui:BetterTextBox.Mode="Integer" Margin="0" />
                        </mui:SpacingUniformGrid>
                      </mui:BooleanSwitch.True>
                      <mui:BooleanSwitch.False>
                        <mui:SpacingUniformGrid HorizontalSpacing="8" Rows="1">
                          <mui:ValueLabel Value="{Binding MandatoryPitFrom}" Content="From" Postfix=" lap" mui:BetterTextBox.Mode="Integer" Margin="0" />
                          <mui:ValueLabel Value="{Binding MandatoryPitTo}" Content="To" Postfix=" lap" mui:BetterTextBox.Mode="Integer" Margin="0" />
                        </mui:SpacingUniformGrid>
                      </mui:BooleanSwitch.False>
                    </mui:BooleanSwitch>
                  </DockPanel>

                  <DockPanel ToolTip="Repeat race with reversed grid; top X position or −1 for all valid positions">
                    <mui:ValueLabel Value="{Binding ReversedGridRacePositions}" Content="Reversed grid" HorizontalAlignment="Left" Margin="0 8 0 0" />
                  </DockPanel>

                </StackPanel>
              </DockPanel>

            </DataTemplate>
          </ContentControl.Resources>
        </ContentControl>
      </DataTemplate>
    </ResourceDictionary>
  </UserControl.Resources>

  <ScrollViewer Padding="0 0 8 0">
    <DockPanel>
      <StackPanel Style="{StaticResource SettingsPanel}" DockPanel.Dock="Top" Margin="0 0 0 20">
        <CheckBox IsChecked="{Binding SelectedObject.PickupMode}" IsEnabled="{Binding SelectedObject.IsPickupModeAvailable}">
          <Label Content="Pickup mode" />
        </CheckBox>

        <CheckBox IsChecked="{Binding SelectedObject.PickupModeLockedEntryList}" IsEnabled="{Binding SelectedObject.IsPickupModeAvailable}">
          <Label Content="Locked entry list in pickup mode" ToolTip="Flag it if you want to limit the server to the entrylist GUID players and ignore password" />
        </CheckBox>

        <CheckBox IsChecked="{Binding SelectedObject.LoopMode}">
          <Label Content="Loop mode" />
        </CheckBox>
      </StackPanel>

      <mui:SpacingUniformGrid x:Name="ColumnsGrid" Columns="2" HorizontalSpacing="20" VerticalSpacing="20" StackMode="True">
        <ItemsControl ItemsSource="{Binding SelectedObject.SimpleSessions}" ItemTemplate="{StaticResource SessionTemplate}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <mui:SpacingStackPanel Spacing="20" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
        </ItemsControl>
        <ContentPresenter ContentTemplate="{StaticResource SessionTemplate}" Content="{Binding SelectedObject.RaceSession}" />
      </mui:SpacingUniformGrid>
    </DockPanel>
  </ScrollViewer>
</UserControl>