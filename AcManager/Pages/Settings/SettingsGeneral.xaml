<UserControl x:Class="AcManager.Pages.Settings.SettingsGeneral" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:watermark="clr-namespace:FirstFloor.ModernUI.Windows.Controls.Watermark;assembly=FirstFloor.ModernUI"
        xmlns:settings="clr-namespace:AcManager.Pages.Settings" xmlns:mui="http://firstfloorsoftware.com/ModernUI"
        xmlns:helpers="clr-namespace:AcManager.Tools.Helpers;assembly=AcManager.Tools"
        xmlns:internal="clr-namespace:AcManager.Internal;assembly=AcManager.Internal"
        xmlns:limitedMark="clr-namespace:FirstFloor.ModernUI.Windows.Controls.LimitedMark;assembly=FirstFloor.ModernUI" mc:Ignorable="d" d:DesignHeight="300"
        d:DesignWidth="300" FocusVisualStyle="{x:Null}" d:DataContext="{d:DesignInstance settings:SettingsGeneral+GeneralViewModel}">
    <UserControl.Resources>
        <mui:SharedResourceDictionary Source="/AcManager.Controls;component/Assets/SettingsSpecific.xaml" />
    </UserControl.Resources>
    <ScrollViewer>
        <StackPanel Style="{StaticResource SettingsPanel}">
            <DockPanel>
                <Label>Assetto Corsa folder:</Label>
                <Button Command="{Binding ChangeAcRootCommand}">Change</Button>
                <TextBox Style="{StaticResource TextBoxAsTextBlock.ReadOnly}" Text="{Binding AcRootDirectoryValue, Mode=OneTime}" />
            </DockPanel>

            <!--versions-->
            <TextBlock Style="{StaticResource SettingsPanel.Heading2}">App:</TextBlock>

            <DockPanel>
                <Label>App key:</Label>
                <Button Command="{Binding ChangeAppKeyCommand}">Change</Button>
                <TextBlock Text="{Binding Source={x:Static internal:AppKeyHolder.KeySafe}, Mode=OneTime}" watermark:WatermarkService.Watermark="?" />
            </DockPanel>

            <CheckBox IsChecked="{Binding CommonSettings.CreateStartMenuShortcutIfMissing}"
                    ToolTip="Create Start Menu shortcut if it's missing, might be able to help if there are no popup notifications">
                <Label>Start Menu shortcut</Label>
            </CheckBox>

            <!--versions-->
            <TextBlock Style="{StaticResource SettingsPanel.Heading2}">Auto Updates:</TextBlock>

            <DockPanel>
                <Label>Check for updates:</Label>
                <ComboBox ItemsSource="{Binding CommonSettings.Periods}" SelectedItem="{Binding CommonSettings.UpdatePeriod}" DisplayMemberPath="DisplayName" />
            </DockPanel>

            <!--app version-->
            <DockPanel>
                <Label>App version:</Label>
                <Button Command="{Binding AppUpdater.CheckAndPrepareIfNeededCommand}" IsEnabled="{Binding AppUpdater.IsSupported}">Check for Updates</Button>
                <TextBox Style="{StaticResource TextBoxAsTextBlock.ReadOnly}"
                        Text="{Binding Source={x:Static helpers:BuildInformation.AppVersion}, Mode=OneTime}" watermark:WatermarkService.Watermark="?" />
            </DockPanel>

            <TextBlock Text="{Binding AppUpdater.LatestError}" Margin="136 0 0 8" FontWeight="Bold" Foreground="{DynamicResource Error}"
                    Visibility="{Binding AppUpdater.LatestError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=inverse}" />

            <!--content version-->
            <DockPanel>
                <Label>Content version:</Label>
                <Button Command="{Binding ContentSyncronizer.CheckAndUpdateIfNeededCommand}">Check for Updates</Button>
                <TextBox Style="{StaticResource TextBoxAsTextBlock.ReadOnly}" Text="{Binding ContentSyncronizer.InstalledVersion, Mode=OneWay}"
                        watermark:WatermarkService.Watermark="?" />
            </DockPanel>
            <TextBlock Text="{Binding ContentSyncronizer.LatestError}" Margin="136 0 0 8" FontWeight="Bold" Foreground="{DynamicResource Error}"
                    Visibility="{Binding ContentSyncronizer.LatestError, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=inverse}" />

            <!--values storage-->
            <TextBlock Style="{StaticResource SettingsPanel.Heading2}">Values Storage:</TextBlock>

            <DockPanel>
                <Label>Size:</Label>
                <Button Command="{Binding CleanUpStorageCommand}" ToolTip="Remove all nonimportant values">Clean Up</Button>
                <TextBlock Text="{Binding ValuesStorage.Count, Converter={StaticResource PluralizingConverter}, ConverterParameter='{}{0} entry', Mode=OneWay}" />
            </DockPanel>

            <!--beta access-->
            <TextBlock Style="{StaticResource SettingsPanel.Heading2}">Testing Access:</TextBlock>
            <CheckBox IsChecked="{Binding CommonSettings.UpdateToNontestedVersions}" IsEnabled="{x:Static internal:AppKeyHolder.IsAllRight}"
                    limitedMark:LimitedService.Limited="True" HorizontalAlignment="Left" ClipToBounds="False" Padding="0 0 24 0">
                <Label>Update to non-tested versions</Label>
            </CheckBox>
            <Button Command="{Binding SendLogsCommand}">Send Logs to Developers (Use It When There Is a Problem)</Button>
        </StackPanel>
    </ScrollViewer>
</UserControl>
